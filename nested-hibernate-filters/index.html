<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Nested Hibernate Filters</title>
<meta name="viewport" content="width=device-width">
<link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
<!-- syntax highlighting CSS -->
<!--link rel="stylesheet" href="/css/syntax.css"-->

<!-- Custom CSS -->
<link rel="stylesheet" href="/assets/application-1070e5396a9f348b2c31565a8ca2ade6.css">

<!-- Custom JS -->
<script src="/assets/vendor/jquery-2.1.1-fbf0c31ef61d80bbbc98a9cdfc7e6632.js"></script>
<script src="/assets/vendor/jquery.validate-466ee815d7a2fb9b74b895b6a0f9551c.js"></script>
<script src="/assets/vendor/scrollup/jquery.scrollUp-d730604bacd24a59da00d38b42cd77af.js"></script>
<script src="/assets/vendor/drupal_legacy-d5580e3eaf6de5a1446255d180dc73d3.js"></script>
<script src="/assets/vendor/angular.min-dfd2efe0eaac3581c5faf5cfed3b159e.js"></script>
<script src="/assets/meetup_events-5782f731b79266fd93b159cb798cc3d5.js"></script>
<script src="/assets/contact-897905f16738b8c5c1688eefae319441.js"></script>
<script src="/assets/application-07f972327fcb4602f91f1e8ba4b78498.js"></script>

<!-- ShareThis JS for posts section -->
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "6ae64a50-63a5-4021-a8de-b0adce0ce99b", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    </head>

    <body class="one-sidebar sidebar-second section-jsandroidjavarubydevops page-node node-type-article all-pages with-navigation with-subnav featured dir-ltr">
        <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=519865898033052&version=v2.0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
        <div id="header-first">
  <div class="region region-header-first">
    <div id="block-search-form" class="block block-search block-odd">

      <div class="content">
        <form id="search-block-form" accept-charset="UTF-8"><div><div class="container-inline">
              <h2 class="element-invisible">Search form</h2>
              <div class="form-item form-type-textfield form-item-search-block-form">
                <label class="element-invisible" for="edit-search-block-form--2">Search </label>
                <input title="Enter the terms you wish to search for." placeholder="Search" type="search" id="edit-search-block-form--2" name="search_block_form" value="" size="15" maxlength="128" class="form-text">
              </div>
              <div class="form-actions form-wrapper" id="edit-actions"><input type="submit" id="edit-submit" name="op" value="Search" class="form-submit"></div><input type="hidden" name="form_build_id" value="form-hCEJ23kB0sHlr4dB3Yv5-2cDcH10yNwGSUn69WjCjF4">
              <input type="hidden" name="form_id" value="search_block_form">
            </div>
      </div></form>  </div><!-- /.content -->
    </div><!-- /.block -->
    <div id="block-menu-menu-top-links" class="block block-menu block-even">

      <div class="content">
        <ul class="menu clearfix"><li class="first last leaf login"><a href="/user" title="">login</a></li>
      </ul>  </div><!-- /.content -->
    </div><!-- /.block -->
    <div id="block-menu-menu-language" class="block block-menu block-odd">
      
      <div class="content">
        <ul class="menu clearfix"><li class="first last leaf עברית"><a href="/hebrew" title="">עברית</a></li>
      </ul>  </div><!-- /.content -->
    </div><!-- /.block -->
  </div>
</div>
<div id="google-search-form" style="visibility:hidden; width: 1px; height: 1px; float:right;">
  <script>

    (function() {
        var cx = '012617499894110201007:qu0yvmmzksu';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = false;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
    })();
</script>
<gcse:searchresults-only linkTarget="_self"></gcse:searchresults-only>


<script>
    $(document).ready(function() {
        $('#search-block-form').submit(function (e) {
            e.preventDefault();

            //find google search form
            var form = $('.gsc-control-wrapper-cse').find('form');
            var input = form.find("input[name='search']");
            var btn = form.find("input[type='image']");
            var tikalSearch = $('#edit-search-block-form--2');
            tikalSearch.blur();
            $("#bg").show();
            input.val(tikalSearch.val());
            //form.submit();
            btn.click();

        });
        
    });


</script>

</div>

        <header id="header" role="banner">
  <div class="logo-and-region-header">
    <div class="background-logo"></div>
    <a href="/" title="Home" rel="home" id="logo">
      <img src="/assets/logo-ebc269c722e9e1e11b3252c442c75750.png" alt="Home">
    </a>


    <div class="region region-header">
      <section id="block-menu-menu-header-menu" class="block block-menu block-even">
        <h2 class="block-title element-invisible">Header menu</h2>

        <div class="content">
          <ul class="menu clearfix">
            
              
              <li class="leaf"><a href="/about" class="">About</a></li>
            
              
              <li class="leaf"><a href="/solutions" class="">Solutions</a></li>
            
              
              <li class="leaf"><a href="/careers" class="">Careers</a></li>
            
              
              <li class="leaf"><a href="/events" class="">Events</a></li>
            
              
              <li class="leaf"><a href="/contact" class="">Contact</a></li>
            
        </ul>  </div><!-- /.content -->
      </section><!-- /.block -->
      <section id="block-menu-menu-domains" class="block block-menu block-odd">
        <h2 class="block-title element-invisible">Domains</h2>

        <div class="content">
          <ul class="menu clearfix"><li class="first leaf devops"><a href="/devops" title="">DevOps</a></li>
            <li class="leaf java"><a href="/java" title="">JAVA</a></li>
            <li class="leaf js"><a href="/js" title="">JS</a></li>
            <li class="leaf android"><a href="/android" title="">Android</a></li>
            <li class="last leaf ruby"><a href="/ruby" title="">Ruby</a></li>
        </ul>  </div><!-- /.content -->
      </section><!-- /.block -->
    </div>
  </div><!-- /#logo-and-region-header -->
</header>

        <div class="featured-background">
  <div id="featured">
    <div class="region-title-and-featured">
      <h1 class="title" id="page-title">Nested Hibernate Filters</h1>
      <div class="region region-featured">
        <div id="block-views-author-block" class="block block-views">
          <div class="content">
            <div class="view view-author view-id-author view-display-id-block">
  <div class="view-content">
    <div class="view-content-limit">
      <div class="view-content-limit-content">
        <div class="views-row">
          <div class="views-field views-field-picture">
            <div class="field-content">
              
                <img src="/assets/pictures/profile-default-ab65955ebe8cf05005dc2e1ae497d862.jpg" width="307" height="230" alt="">
              
            </div>  
          </div>
          <div class="views-field views-field-field-first-name">
            <div class="field-content">Chaim</div>
          </div>
          <div class="views-field views-field-field-last-name">
            <div class="field-content">Turkel</div>
          </div>
          <div class="views-field views-field-field-description">
            <div class="field-content">Sr. Java Developer</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

        <div class="shadow-page"></div>
        <div id="page">
          <div id="main">
            <div class="region region-content">
              <div id="block-system-main" class="block block-system">
                <div class="content">
                  <article class="node node-article published with-comments node-full">
                    <header>
  <div class="by-and-tags">
    <div class="by">
      <div class="label-by">by</div>
      <div class="name">
        <a href='/java/chaimturkel'>chaim.turkel</a>
      </div>
    </div>
    <div class="tags">
      <div class="label-tags">tags:</div>
      <div class="float-tags">
        <div class="field field-name-field-tags field-type-taxonomy-term-reference field-label-hidden clearfix">
          <ul class="links">
            
              <li>
                <a href="/tags/JAVA">JAVA</a>
              </li>
            
              <li>
                <a href="/tags/Hibernate">Hibernate</a>
              </li>
            
              <li>
                <a href="/tags/filters">filters</a>
              </li>
            
              <li>
                <a href="/tags/Stack">Stack</a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
  <time pubdate="" datetime="2013-07-29 00:00:00 +0300">
        <div class="day">29</div>
        Jul. 2013
      </time>
  
  
  


<span class="share-buttons">
  <span st_url='http://tikalk.com/nested-hibernate-filters' st_title='Nested Hibernate Filters' class='st_facebook_hcount' displayText='Facebook'></span>
  <span st_url='http://tikalk.com/nested-hibernate-filters' st_title='Nested Hibernate Filters' class='st_linkedin_hcount' displayText='LinkedIn'></span>
  <span st_url='http://tikalk.com/nested-hibernate-filters' st_title='Nested Hibernate Filters' class='st_twitter_hcount' displayText='Tweet'></span>
  <span st_url='http://tikalk.com/nested-hibernate-filters' st_title='Nested Hibernate Filters' class='st_fblike_hcount' displayText='Facebook Like'></span>
  <span st_url='http://tikalk.com/nested-hibernate-filters' st_title='Nested Hibernate Filters' class='st_plusone_hcount' displayText='Google +1'></span>
</span>
</header>

                    <h1>
    Nested Hibernate Filters<o:p></o:p></h1>

<div class="MsoNormal">
    Hibernate added a feature that is not part of the JPA, and this is filters. <o:p></o:p></div>

<div class="MsoNormal">
    When you want to load information from the database but want to filter the data, you can use HQL, @Where or filters.<o:p></o:p></div>

<div class="MsoNormal">
    HQL is good if your filter is limited to the query that you need. If you always want to filter the class you can add to the class the @Where. In the cases that you sometimes want to filter and sometimes not, or you need to parameterize the filtering then you use the @Filters.<o:p></o:p></div>

<div class="MsoNormal">
    It feels like all the features of filtering were an afterthought by hibernate. The reason is that hibernate does not use the field names for the filtering or @Where but uses the database field name. The reason they do this, is that it is easy to add to the sql statement the where statement, and they do not have to parse the class objects.<o:p></o:p></div>

<div class="MsoNormal">
    For more information on filters see: <a href="http://docs.jboss.org/hibernate/orm/3.6/reference/en-US/html/filters.html">http://docs.jboss.org/hibernate/orm/3.6/reference/en-US/html/filters.html</a>, <a href="http://java.dzone.com/articles/introduction-hibernate-filters">http://java.dzone.com/articles/introduction-hibernate-filters</a>.<o:p></o:p></div>

<div class="MsoNormal">
    Another oversight on the filter issue is nested filters. Hibernate does not care how many times you enable the filter, one disable will disable it in any case. Also if you change the parameter of a filter that is already open hibernate has no problem and will update the fiter.<o:p></o:p></div>

<h2>
    Take the following case:<o:p></o:p></h2>

<div class="MsoNormal">
    Enable filter, date: 1/1/2000<o:p></o:p></div>

<div class="MsoNormal" style="text-indent: .5in;">
    Load data<o:p></o:p></div>

<div class="MsoNormal" style="text-indent: .5in;">
    Enable filter, date: 1/1/1999<o:p></o:p></div>

<div class="MsoNormal" style="margin-left: .5in; text-indent: .5in;">
    Load data<o:p></o:p></div>

<div class="MsoNormal">
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Disable filter<o:p></o:p></div>

<div class="MsoNormal" style="text-indent: .5in;">
    Load data<o:p></o:p></div>

<div class="MsoNormal">
    Disable filter<o:p></o:p></div>

<div class="MsoNormal">
    &nbsp;</div>

<div class="MsoNormal">
    In this scenario we have two problems. Once the disable filter is called there is no open filter so the third load data will run with no filter at all. Even if the filter was not closed we would still have the problem that the date of the filter is incorrect, since it is set for 1999 and not 2000.<o:p></o:p></div>

<div class="MsoNormal">
    To solve this issue we need to implement a stack of filters per filter name and store them on the local thread (so that our genericdao is thread safe).<o:p></o:p></div>

<h2>
    <span style="background: silver; mso-highlight: silver;">FilterInfo</span> Class<o:p></o:p></h2>

<div class="MsoNormal">
    The first class will hold the parameters of the filter and what is the nested count (how many times has the enable been called for the same filter with the same parameters):<o:p></o:p></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">class</span></b><span style="font-family: Consolas; font-size: 10pt;"> <span style="background: silver; mso-highlight: silver;">FilterInfo</span> {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">private</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">int</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">nestedCount</span><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">private</span></b><span style="font-family: Consolas; font-size: 10pt;"> Map&lt;String, Object&gt; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">parameters</span><span style="font-family: Consolas; font-size: 10pt;"> = </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">new</span></b><span style="font-family: Consolas; font-size: 10pt;"> HashMap&lt;String, Object&gt;();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> FilterInfo(Map&lt;String, Object&gt; parameters) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">super</span></b><span style="font-family: Consolas; font-size: 10pt;">();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">this</span></b><span style="font-family: Consolas; font-size: 10pt;">.</span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">parameters</span><span style="font-family: Consolas; font-size: 10pt;"> = parameters;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">boolean</span></b><span style="font-family: Consolas; font-size: 10pt;"> areParametersTheSame(Map&lt;String, Object&gt; currentParameters) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (</span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">parameters</span><span style="font-family: Consolas; font-size: 10pt;">.size() &gt; 0) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #3f7f5f; font-family: Consolas; font-size: 10.0pt;">// check old parameters, see if changed</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">for</span></b><span style="font-family: Consolas; font-size: 10pt;"> (String paramName : </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">parameters</span><span style="font-family: Consolas; font-size: 10pt;">.keySet()) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">for</span></b><span style="font-family: Consolas; font-size: 10pt;"> (String currentparamName : currentParameters.keySet()) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (paramName.equals(currentparamName)) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object newValue = </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">parameters</span><span style="font-family: Consolas; font-size: 10pt;">.get(paramName);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object oldValue = currentParameters.get(paramName);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (!newValue.equals(oldValue)) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">false</span></b><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">true</span></b><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">int</span></b><span style="font-family: Consolas; font-size: 10pt;"> decNestedCount() {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">nestedCount</span><span style="font-family: Consolas; font-size: 10pt;">--;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">nestedCount</span><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">int</span></b><span style="font-family: Consolas; font-size: 10pt;"> incNestedCount() {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">nestedCount</span><span style="font-family: Consolas; font-size: 10pt;">++;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">nestedCount</span><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> Map&lt;String, Object&gt; getParameters() {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">parameters</span><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">int</span></b><span style="font-family: Consolas; font-size: 10pt;"> getNestedCount() {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">nestedCount</span><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">}</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal">
    &nbsp;</div>

<h2>
    <span style="background: silver; mso-highlight: silver;">FilterStack</span> Class<o:p></o:p></h2>

<div class="MsoNormal">
    This class will store a stack of the parameters per filter so that we can re enable the filter with the correct parameters once a nested filter is disabled.<o:p></o:p></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">class</span></b><span style="font-family: Consolas; font-size: 10pt;"> <span style="background: silver; mso-highlight: silver;">FilterStack</span> {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">private</span></b><span style="font-family: Consolas; font-size: 10pt;"> String </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterName</span><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">private</span></b><span style="font-family: Consolas; font-size: 10pt;"> Stack&lt;FilterInfo&gt; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;"> = </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">new</span></b><span style="font-family: Consolas; font-size: 10pt;"> Stack&lt;FilterInfo&gt;();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> FilterStack(String filterName) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">this</span></b><span style="font-family: Consolas; font-size: 10pt;">.</span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterName</span><span style="font-family: Consolas; font-size: 10pt;"> = filterName;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> FilterInfo setParameters(Map&lt;String, Object&gt; parameters) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">boolean</span></b><span style="font-family: Consolas; font-size: 10pt;"> areParametersTheSame = </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">false</span></b><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FilterInfo filterInfo = </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">null</span></b><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (</span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;">.size() &gt; 0) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filterInfo = </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;">.peek();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; areParametersTheSame = filterInfo.areParametersTheSame(parameters);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (!areParametersTheSame) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #3f7f5f; font-family: Consolas; font-size: 10.0pt;">// add a new stack</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filterInfo = </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">new</span></b><span style="font-family: Consolas; font-size: 10pt;"> FilterInfo(parameters);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;">.push(filterInfo);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filterInfo.incNestedCount();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> filterInfo;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> FilterInfo disableFilter() {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (</span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;">.size()==0) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">throw</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">new</span></b><span style="font-family: Consolas; font-size: 10pt;"> InfraException(</span><span style="color: #2a00ff; font-family: Consolas; font-size: 10.0pt;">&quot;you are closing a filter that is not open: &quot;</span><span style="font-family: Consolas; font-size: 10pt;"> + </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterName</span><span style="font-family: Consolas; font-size: 10pt;">);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FilterInfo peek = </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;">.peek();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (peek != </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">null</span></b><span style="font-family: Consolas; font-size: 10pt;">) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">int</span></b><span style="font-family: Consolas; font-size: 10pt;"> decNestedCount = peek.decNestedCount();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (decNestedCount &lt;= 0) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;">.pop();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;">.size()&gt;0 ?&nbsp; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filterStack</span><span style="font-family: Consolas; font-size: 10pt;">.peek() : </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">null</span></b><span style="font-family: Consolas; font-size: 10pt;">;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> peek;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">}</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal">
    &nbsp;</div>

<h2>
    <span style="background: silver; mso-highlight: silver;">NestedFilterInfo</span> Class<o:p></o:p></h2>

<div class="MsoNormal">
    The last class will be stored on the local thread, and will hold all the information for all the open filters.<o:p></o:p></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">class</span></b><span style="font-family: Consolas; font-size: 10pt;"> <span style="background: silver; mso-highlight: silver;">NestedFilterInfo</span> {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">private</span></b><span style="font-family: Consolas; font-size: 10pt;"> Map&lt;String, FilterStack&gt; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filtersByName</span><span style="font-family: Consolas; font-size: 10pt;"> = </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">new</span></b><span style="font-family: Consolas; font-size: 10pt;"> HashMap&lt;String, FilterStack&gt;();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> FilterInfo enableFilter(String filterName, Map&lt;String, Object&gt; parameters) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #3f7f5f; font-family: Consolas; font-size: 10.0pt;">// get current filter information</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FilterStack filterStack = </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filtersByName</span><span style="font-family: Consolas; font-size: 10pt;">.get(filterName);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (filterStack == </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">null</span></b><span style="font-family: Consolas; font-size: 10pt;">) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filterStack = </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">new</span></b><span style="font-family: Consolas; font-size: 10pt;"> FilterStack(filterName);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filtersByName</span><span style="font-family: Consolas; font-size: 10pt;">.put(filterName, filterStack);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #3f7f5f; font-family: Consolas; font-size: 10.0pt;">// check if filter parameters have changed.</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> filterStack.setParameters(parameters);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> FilterInfo disableFilter(String filterName) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FilterStack filterStack = </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filtersByName</span><span style="font-family: Consolas; font-size: 10pt;">.get(filterName);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> filterStack.disableFilter();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> Set&lt;String&gt; getFilterNames() {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">return</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filtersByName</span><span style="font-family: Consolas; font-size: 10pt;">.keySet();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">void</span></b><span style="font-family: Consolas; font-size: 10pt;"> clear() {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000c0; font-family: Consolas; font-size: 10.0pt;">filtersByName</span><span style="font-family: Consolas; font-size: 10pt;">.clear();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">}</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal">
    &nbsp;</div>

<div class="MsoNormal">
    &nbsp;</div>

<h2>
    GenericDao class<o:p></o:p></h2>

<div class="MsoNormal">
    In the generic dao class that actually opens and closes the filter will use these classes to manage all open filters. The function to enable a filter will call:<o:p></o:p></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">void</span></b><span style="font-family: Consolas; font-size: 10pt;"> <span style="background: silver; mso-highlight: silver;">enableFilter</span>(String filterName, Map&lt;String, Object&gt; mapParameters) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt; text-indent: 0.5in;">
    <span style="font-family: Consolas; font-size: 10pt;">NestedFilterInfo filterStack = getFilterStack();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FilterInfo enableFilter = filterStack.enableFilter(filterName, mapParameters);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sessionEnableFilter(filterName, enableFilter.getParameters());</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">}<o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">private</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">void</span></b><span style="font-family: Consolas; font-size: 10pt;"> <span style="background: silver; mso-highlight: silver;">sessionEnableFilter</span>(String filterName, Map&lt;String, Object&gt; mapParameters) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Filter filter = session().enableFilter(filterName);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object value;</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (mapParameters != </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">null</span></b><span style="font-family: Consolas; font-size: 10pt;">) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">for</span></b><span style="font-family: Consolas; font-size: 10pt;"> (Map.Entry&lt;String, Object&gt; entryParameters : mapParameters.entrySet()) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value = entryParameters.getValue();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filter.setParameter(entryParameters.getKey(), value);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">}<o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    &nbsp;</div>

<div class="MsoNormal">
    The enabling filter is the easy part. For every enable filter if no parameters have changed we will increment the counter on the FilterInfo class. If the parameters have changed we will create a new FIlterInfo and add it to the stack in the FilterStack.<o:p></o:p></div>

<div class="MsoNormal">
    The magic is done in the disable filter:<o:p></o:p></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">public</span></b><span style="font-family: Consolas; font-size: 10pt;"> </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">void</span></b><span style="font-family: Consolas; font-size: 10pt;"> disableFilter(String filterName) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NestedFilterInfo filterStack = getFilterStack();</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FilterInfo filterInfo = filterStack.disableFilter(filterName);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">if</span></b><span style="font-family: Consolas; font-size: 10pt;"> (filterInfo == </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">null</span></b><span style="font-family: Consolas; font-size: 10pt;"> || filterInfo.getNestedCount() &lt;= 0) {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; session().disableFilter(filterName);</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } </span><b><span style="color: #7f0055; font-family: Consolas; font-size: 10.0pt;">else</span></b><span style="font-family: Consolas; font-size: 10pt;"> {</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sessionEnableFilter(filterName, filterInfo.getParameters());</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal" style="margin-bottom: 0.0001pt;">
    <span style="font-family: Consolas; font-size: 10pt;">}</span><span style="font-family: Consolas; font-size: 10.0pt;"><o:p></o:p></span></div>

<div class="MsoNormal">
    &nbsp;</div>

<div class="MsoNormal">
    Here we call the disable and get a FilterInfo class. If the nested count is down to zero then we have finished the stack and called the disable the same amount as the enable so we will close the filter on the session. If not then either the stack count went down by one, or we got the previous filter that was open. In either case we update the session filter with the parameters, and this way we have reverted the filter to the previous one.<o:p></o:p></div>

<div class="MsoNormal">
    This solution support both nested filters with the same parameters (only after the last disable with the filter really be closed) and nested filters with different parameters (with the new parameters the session will be updated, and on the disable filter the previous parameters will be returned to the session).<o:p></o:p></div>

<div class="MsoNormal">
    &nbsp;</div>

<div class="MsoNormal">
    &nbsp;</div>

<div class="MsoNormal" style="margin-left: .5in; text-indent: .5in;">
    &nbsp;</div>

<div class="MsoNormal" style="margin-left: .5in; text-indent: .5in;">
    &nbsp;</div>

<div class="MsoNormal">
    &nbsp;</div>

<div class="MsoNormal" style="text-indent: .5in;">
    &nbsp;</div>

<p><br />
<div class="MsoNormal" style="text-indent: .5in;">
    &nbsp;</div></p>

                    <div class="fb-comments" data-href="http://tikalk.com/nested-hibernate-filters" data-width="600px" data-numposts="5" data-colorscheme="light"></div>
                    <footer></footer>
                  </article>
                </div>
              </div>
            </div>
          </div>
        </div>
        <footer id="footer" role="contentinfo">
  <div class="region region-footer">
    <section id="block-block-2" class="block block-block block-about-tikal block-even">
      <h2 class="block-title">About Tikal</h2>

      <div class="content">
        <div>
          <div>
            For over 12 years, we have helped breakthrough companies achieve excellence and meet their goals.&nbsp;</div>
          <div>
            By doing so we've earned recognition for delivering extremely competitive and high-performance software services to clients worldwide.</div>
        </div>
        <div class="contact-title">
          Contact Information</div>
        <div class="contact-number">
          (972) 3 6488618</div>
        <div class="contact-mail">
          <a href="">info@tikalk.com</a></div>
      </div><!-- /.content -->
    </section><!-- /.block -->
    <section id="block-webform-client-block-22" class="block block-webform join-the-team block-odd">
      <h2 class="block-title">Join the Team</h2>
      <div class="content">
        <div>
          <div class="form-item webform-component webform-component-markup" id="webform-component-sub-header">
              <p>Let us contact you with more information</p>
          </div>
          <script type="text/javascript" src="http://form.jotform.me/jsform/41884289305463"></script>
        </div>
      </div><!-- /.content -->
    </section><!-- /.block -->
    <section id="block-general-tikal-map-home-page" class="block block-general-tikal block-even">
      <h2 class="block-title">Find us at:</h2>

      <div class="content">

        <div id="map_canvas_footer" style="width: 240px; height: 200px;"></div>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
        <script type="text/javascript">
            var latlng = new google.maps.LatLng(32.1065469,34.83523969999999);
            var settings = {
            zoom: 15,
                  center: latlng,
                  mapTypeControl: false,
                  mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
                  navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
                  mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map_canvas_footer"), settings);      
            var companyImage = new google.maps.MarkerImage("/assets/icons/logo-map-1a2609d2dd636172949b30cd33a1d8a0.png",
                new google.maps.Size(100,50),
                new google.maps.Point(0,0),
                new google.maps.Point(50,50)
            );
            var companyShadow = new google.maps.MarkerImage("images/logo_shadow.png",
                new google.maps.Size(130,50),
                new google.maps.Point(0,0),
                new google.maps.Point(65, 50)
            );
            var companyPos = new google.maps.LatLng(32.1065469,34.83523969999999);
            var companyMarker = new google.maps.Marker({
              position: companyPos,
              map: map,
              icon: companyImage,
              shadow: companyShadow,
              title:"",
              zIndex: 3}
            );
        </script>  
      </div><!-- /.content -->
    </section><!-- /.block -->
    <div id="block-block-3" class="block block-block find-us-at block-odd">
      <div class="content">
        <div class="address">
          Habarzel 4 st, 1st Floor&nbsp;<br>
          Tel Aviv 69710<br>
          Israel
        </div>  
      </div><!-- /.content -->
    </div><!-- /.block -->
  </div>
</footer>

        <footer id="footer-second" role="contentinfo">
  <div class="region region-footer-second">
    <section id="block-views-popular-articles-block" class="block block-views block-even">
      <h2 class="block-title">Popular Articles</h2>

      <div class="content">
        <div class="view view-popular-articles view-id-popular_articles view-display-id-block view-dom-id-796319b1b70c397287cdccd16eebbb82">

          <div class="view-content">
            <div class="view-content-limit">
              <div class="view-content-limit-content">
                <div class="views-row views-row-1 views-row-odd views-row-first">

                  <div class="views-field views-field-title">        <span class="field-content"><a href="/java/location-auto-complete-and-lookup">Location Auto complete and lookup</a></span>  </div>  </div>
                <div class="views-row views-row-2 views-row-even">

                  <div class="views-field views-field-title">        <span class="field-content"><a href="/js/present-and-future-typescript">Present and future of TypeScript</a></span>  </div>  </div>
                <div class="views-row views-row-3 views-row-odd views-row-last">

                  <div class="views-field views-field-title">        <span class="field-content"><a href="/ror/building-gogobot-social-graph">building the gogobot social graph</a></span>  </div>  </div>
              </div>
            </div>
          </div>

      </div>  </div><!-- /.content -->
    </section><!-- /.block -->
    <section id="block-menu-menu-fields" class="block block-menu block-odd">
      <h2 class="block-title">Domains</h2>

      <div class="content">
        <ul class="menu clearfix"><li class="first leaf application lifecycle management"><a href="/alm" title="">DevOps</a></li>
          <li class="leaf java"><a href="/java" title="">Java</a></li>
          <li class="leaf javascript"><a href="/js" title="">JavaScript</a></li>
          <li class="leaf .net"><a href="/net" title="">Android</a></li>
          <li class="last leaf ruby on rails"><a href="/ror" title="">Ruby</a></li>
      </ul>  </div><!-- /.content -->
    </section><!-- /.block -->
    <section id="block-menu-menu-site-map" class="block block-menu block-even">
      <h2 class="block-title">Site Map</h2>

      <div class="content">
        <ul class="menu clearfix"><li class="first leaf about us"><a href="/about" title="">About Us</a></li>
          <li class="leaf active-trail solutions"><a href="/solutions" title="" class="active-trail active">Solutions</a></li>
          <li class="leaf careers"><a href="/careers" title="">Careers</a></li>
          <li class="leaf events"><a href="/events" title="">Events</a></li>
          <li class="last leaf contact"><a href="/contact" title="">Contact</a></li>
      </ul>  </div><!-- /.content -->
    </section><!-- /.block -->
    <div id="block-block-1" class="block block-block all-rights-reserved block-odd">

      <div class="content">
        <p>© 2013 All Rights Reserved. Tikal</p>
      </div><!-- /.content -->
    </div><!-- /.block -->
    <div id="block-menu-menu-external-links" class="block block-menu block-even">

      <div class="content">
        <ul class="menu clearfix"><li class="first leaf facebook"><a href="http://www.facebook.com/TikalKnowledge" title="" target="_blank">Facebook</a></li>
          <li class="leaf twitter"><a href="https://twitter.com/TikalK" title="" target="_blank">Twitter</a></li>
          <li class="leaf in"><a href="http://www.linkedin.com/company/tikal-knowledge" title="" target="_blank">in</a></li>
          <li class="last leaf rss"><a href="/rss-latest-articles" title="Latest Articles">RSS</a></li>
      </ul>  </div><!-- /.content -->
    </div><!-- /.block -->
  </div>
</footer>

    </body>
</html>
