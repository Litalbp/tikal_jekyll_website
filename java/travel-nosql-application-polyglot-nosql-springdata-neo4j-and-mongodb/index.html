<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Travel NoSQL Application - Polyglot NoSQL with SpringData on Neo4J and MongoDB</title>
<meta name="viewport" content="width=device-width">
<link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
<!-- syntax highlighting CSS -->
<!--link rel="stylesheet" href="/css/syntax.css"-->

<!-- Custom CSS -->
<link rel="stylesheet" href="/assets/application-1070e5396a9f348b2c31565a8ca2ade6.css">

<!-- Custom JS -->
<script src="/assets/vendor/jquery-2.1.1-fbf0c31ef61d80bbbc98a9cdfc7e6632.js"></script>
<script src="/assets/vendor/jquery.validate-466ee815d7a2fb9b74b895b6a0f9551c.js"></script>
<script src="/assets/vendor/scrollup/jquery.scrollUp-d730604bacd24a59da00d38b42cd77af.js"></script>
<script src="/assets/vendor/drupal_legacy-d5580e3eaf6de5a1446255d180dc73d3.js"></script>
<script src="/assets/vendor/angular.min-dfd2efe0eaac3581c5faf5cfed3b159e.js"></script>
<script src="/assets/meetup_events-5782f731b79266fd93b159cb798cc3d5.js"></script>
<script src="/assets/contact-897905f16738b8c5c1688eefae319441.js"></script>
<script src="/assets/application-07f972327fcb4602f91f1e8ba4b78498.js"></script>

<!-- ShareThis JS for posts section -->
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "6ae64a50-63a5-4021-a8de-b0adce0ce99b", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    </head>

    <body class="one-sidebar sidebar-second section-java page-node node-type-article all-pages with-navigation with-subnav featured dir-ltr">
        <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=519865898033052&version=v2.0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
        <div id="header-first">
  <div class="region region-header-first">
    <div id="block-search-form" class="block block-search block-odd">

      <div class="content">
        <form id="search-block-form" accept-charset="UTF-8"><div><div class="container-inline">
              <h2 class="element-invisible">Search form</h2>
              <div class="form-item form-type-textfield form-item-search-block-form">
                <label class="element-invisible" for="edit-search-block-form--2">Search </label>
                <input title="Enter the terms you wish to search for." placeholder="Search" type="search" id="edit-search-block-form--2" name="search_block_form" value="" size="15" maxlength="128" class="form-text">
              </div>
              <div class="form-actions form-wrapper" id="edit-actions"><input type="submit" id="edit-submit" name="op" value="Search" class="form-submit"></div><input type="hidden" name="form_build_id" value="form-hCEJ23kB0sHlr4dB3Yv5-2cDcH10yNwGSUn69WjCjF4">
              <input type="hidden" name="form_id" value="search_block_form">
            </div>
      </div></form>  </div><!-- /.content -->
    </div><!-- /.block -->
    <div id="block-menu-menu-top-links" class="block block-menu block-even">

      <div class="content">
        <ul class="menu clearfix"><li class="first last leaf login"><a href="/user" title="">login</a></li>
      </ul>  </div><!-- /.content -->
    </div><!-- /.block -->
    <div id="block-menu-menu-language" class="block block-menu block-odd">
      
      <div class="content">
        <ul class="menu clearfix"><li class="first last leaf עברית"><a href="/hebrew" title="">עברית</a></li>
      </ul>  </div><!-- /.content -->
    </div><!-- /.block -->
  </div>
</div>
<div id="google-search-form" style="visibility:hidden; width: 1px; height: 1px; float:right;">
  <script>

    (function() {
        var cx = '012617499894110201007:qu0yvmmzksu';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = false;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
    })();
</script>
<gcse:searchresults-only linkTarget="_self"></gcse:searchresults-only>


<script>
    $(document).ready(function() {
        $('#search-block-form').submit(function (e) {
            e.preventDefault();

            //find google search form
            var form = $('.gsc-control-wrapper-cse').find('form');
            var input = form.find("input[name='search']");
            var btn = form.find("input[type='image']");
            var tikalSearch = $('#edit-search-block-form--2');
            tikalSearch.blur();
            $("#bg").show();
            input.val(tikalSearch.val());
            //form.submit();
            btn.click();

        });
        
    });


</script>

</div>

        <header id="header" role="banner">
  <div class="logo-and-region-header">
    <div class="background-logo"></div>
    <a href="/" title="Home" rel="home" id="logo">
      <img src="/assets/logo-ebc269c722e9e1e11b3252c442c75750.png" alt="Home">
    </a>


    <div class="region region-header">
      <section id="block-menu-menu-header-menu" class="block block-menu block-even">
        <h2 class="block-title element-invisible">Header menu</h2>

        <div class="content">
          <ul class="menu clearfix">
            
              
              <li class="leaf"><a href="/about" class="">About</a></li>
            
              
              <li class="leaf"><a href="/solutions" class="">Solutions</a></li>
            
              
              <li class="leaf"><a href="/careers" class="">Careers</a></li>
            
              
              <li class="leaf"><a href="/events" class="">Events</a></li>
            
              
              <li class="leaf"><a href="/contact" class="">Contact</a></li>
            
        </ul>  </div><!-- /.content -->
      </section><!-- /.block -->
      <section id="block-menu-menu-domains" class="block block-menu block-odd">
        <h2 class="block-title element-invisible">Domains</h2>

        <div class="content">
          <ul class="menu clearfix"><li class="first leaf devops"><a href="/devops" title="">DevOps</a></li>
            <li class="leaf java"><a href="/java" title="">JAVA</a></li>
            <li class="leaf js"><a href="/js" title="">JS</a></li>
            <li class="leaf android"><a href="/android" title="">Android</a></li>
            <li class="last leaf ruby"><a href="/ruby" title="">Ruby</a></li>
        </ul>  </div><!-- /.content -->
      </section><!-- /.block -->
    </div>
  </div><!-- /#logo-and-region-header -->
</header>

        <div class="featured-background">
  <div id="featured">
    <div class="region-title-and-featured">
      <h1 class="title" id="page-title">Travel NoSQL Application - Polyglot NoSQL with SpringData on Neo4J and MongoDB</h1>
      <div class="region region-featured">
        <div id="block-views-author-block" class="block block-views">
          <div class="content">
            <div class="view view-author view-id-author view-display-id-block">
  <div class="view-content">
    <div class="view-content-limit">
      <div class="view-content-limit-content">
        <div class="views-row">
          <div class="views-field views-field-picture">
            <div class="field-content">
              
                <img typeof="foaf:Image" src="/assets/pictures/picture-51-1361228853-03465e84095f1b341f59ad57fcb5e142.jpg" width="307" height="230" alt="">
              
            </div>  
          </div>
          <div class="views-field views-field-field-first-name">
            <div class="field-content">Yanai</div>
          </div>
          <div class="views-field views-field-field-last-name">
            <div class="field-content">Franchi</div>
          </div>
          <div class="views-field views-field-field-description">
            <div class="field-content">Java Architect</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

        <div class="shadow-page"></div>
        <div id="page">
          <div id="main">
            <div class="region region-content">
              <div id="block-system-main" class="block block-system">
                <div class="content">
                  <article class="node node-article published with-comments node-full">
                    <header>
  <div class="by-and-tags">
    <div class="by">
      <div class="label-by">by</div>
      <div class="name">
        <a href='/java/yanai'>yanai</a>
      </div>
    </div>
    <div class="tags">
      <div class="label-tags">tags:</div>
      <div class="float-tags">
        <div class="field field-name-field-tags field-type-taxonomy-term-reference field-label-hidden clearfix">
          <ul class="links">
            
              <li>
                <a href="/tags/JAVA">JAVA</a>
              </li>
            
              <li>
                <a href="/tags/NoSQL-SpringData-Polyglot-Persistence">NoSQL SpringData Polyglot Persistence</a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
  <time pubdate="" datetime="2012-12-26 00:00:00 +0200">
        <div class="day">26</div>
        Dec. 2012
      </time>
  
  
  


<span class="share-buttons">
  <span st_url='http://tikalk.com/java/travel-nosql-application-polyglot-nosql-springdata-neo4j-and-mongodb' st_title='Travel NoSQL Application - Polyglot NoSQL with SpringData on Neo4J and MongoDB' class='st_facebook_hcount' displayText='Facebook'></span>
  <span st_url='http://tikalk.com/java/travel-nosql-application-polyglot-nosql-springdata-neo4j-and-mongodb' st_title='Travel NoSQL Application - Polyglot NoSQL with SpringData on Neo4J and MongoDB' class='st_linkedin_hcount' displayText='LinkedIn'></span>
  <span st_url='http://tikalk.com/java/travel-nosql-application-polyglot-nosql-springdata-neo4j-and-mongodb' st_title='Travel NoSQL Application - Polyglot NoSQL with SpringData on Neo4J and MongoDB' class='st_twitter_hcount' displayText='Tweet'></span>
  <span st_url='http://tikalk.com/java/travel-nosql-application-polyglot-nosql-springdata-neo4j-and-mongodb' st_title='Travel NoSQL Application - Polyglot NoSQL with SpringData on Neo4J and MongoDB' class='st_fblike_hcount' displayText='Facebook Like'></span>
  <span st_url='http://tikalk.com/java/travel-nosql-application-polyglot-nosql-springdata-neo4j-and-mongodb' st_title='Travel NoSQL Application - Polyglot NoSQL with SpringData on Neo4J and MongoDB' class='st_plusone_hcount' displayText='Google +1'></span>
</span>
</header>

                    <p>&nbsp;In this Fuse day, Tikal Java group decided to continue <a href="http://www.tikalk.com/java/build-your-first-hadoop-project-maven">its previous Fuse research for NoSQL</a>, but this time from a different point of view &ndash; SpringData and Polyglot persistence. We had two goals in this Fuse day: try working with more than one <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> in the same application, and also taking advantage of <a href="http://www.springsource.org/spring-data">SpringData</a> data access abstractions for NoSQL databases. We decided to take <a href="http://www.mongodb.org/">MongoDB</a> and <a href="http://www.neo4j.org/">Neo4J</a> as document DB, and Neo4J as graph database and put them behind an existing, classic and well known application &ndash; <a href="http://richweb.springsource.org/swf-booking-faces/spring/intro">Spring Travel Sample application</a>.</p>

<p>&nbsp;</p>

<p><img src="/files/upload/27/fuse_0.jpg" alt="Spring Travel Application" width="1153" height="696" /></p>

<p>&nbsp;</p>

<p>This is a kind of &ldquo;hello world&rdquo; application for Spring users, which demonstrates a very simple hotel bookings application, using Spring framework with JPA to access RDBMS. As said, our goal was to replace the RDBMS behind this app, with the two NoSQL above. Obviously this wasn't done for architecture reasons, since RDBMS can serve perfectly for this simple application. We merely wanted to understand, how hard is to migrate a simple Spring/JPA application to SpringData/NoSQL, and how hard is to use more than one NoSQL on the same project (while gaining some hand-on experience with these technologies).</p>

<p>&nbsp;</p>

<p>We split our work into three phases:</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm"><u><b>Phase 1 &ndash; Integrate Neo4J to Travel Application</b></u></p>

<pre title="code" class="brush: java;">
&lt;dependency&gt;
&lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
   &lt;artifactId&gt;spring-data-neo4j&lt;/artifactId&gt;
   &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;             
   &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;    
   &lt;artifactId&gt;spring-data-neo4j-rest&lt;/artifactId&gt;
   &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p style="margin-bottom: 0cm">Next, we converted the simple domain objects to Graph model. In graph model you have two constructs : Nodes and Relationships. Both nodes and relationships can have properties, so there is somewhat less impedance mismatch to Object Oriented world , compare to RDBMS-to-OO one.</p>

<p style="margin-bottom: 0cm">We converted the Hotel and User entities to graph Nodes and the Booking entity to Relationship typed &ldquo;BOOKD&rdquo;. We also changed the JPA @ID annotation to @GraphID and marked some of the properties as @Index. The @Index enables fast search by Neo4J for nodes by these properties - Behind the scenes Neo4J uses <a href="http://lucene.apache.org/core/">Lucene fast full text search index</a> for that matter. Here are some code snippets from the the entities:</p>

<pre title="code" class="brush: java;">
//@Entity
@NodeEntity
public class Hotel implements Serializable {
    @GraphId
    private Long id;
    @Indexed(indexType = IndexType.FULLTEXT, indexName = &quot;search&quot;)
    private String name;
    ...
}</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<pre title="code" class="brush: java;">
//@Entity
//@Table(name = &quot;Customer&quot;)
@NodeEntity
public class User implements Serializable {
    @GraphId
    private Long id;    
    @Indexed
    private String username;
    private String password;
    @RelatedToVia(type=&quot;BOOKED&quot;)
    List&lt;Booking&gt; bookings;
    &hellip;
}</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<pre title="code" class="brush: java;">
//@Entity
@RelationshipEntity(type=&quot;BOOKED&quot;)
public class Booking implements Serializable {
    @GraphId
    private Long id;
    @StartNode
    private User user;
    @EndNode
    private Hotel hotel;
    private String creditCard;
    ...
}</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">Next step, was to define SpringData Repositories. We created two interfaces: HotelRepository and UserRepository. Both interfaces extends SpringData's <a href="http://static.springsource.org/spring-data/data-neo4j/docs/2.1.0.RELEASE/api/org/springframework/data/neo4j/repository/GraphRepository.html">GraphRepority</a> interface. We were happy for the no-need to implement the interfaces - They are been implemented automatically by SpringData using method naming conventions :)</p>

<p style="margin-bottom: 0cm">Next, we had to integrate the new interfaces into a new BookingService implementation of the existing BookingService interface. This new implementation uses the new created repositories above, to implement the expected behavior. Thus , we kept the MVC layer and GUI as is.</p>

<p style="margin-bottom: 0cm">Last step, was creating  a small Spring configuration file, which defines the GraphDataService bean and our base package for the repositories interfaces above:</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<pre title="code" class="brush: java;">
&lt;beans...&gt;    
    &lt;context:spring-configured/&gt;
    &lt;context:annotation-config/&gt;
    &lt;context:component-scan base-package=&quot;org.springframework.samples.travel&quot; /&gt;
    &lt;neo4j:config graphDatabaseService=&quot;graphDatabaseService&quot;/&gt;
    &lt;bean id=&quot;graphDatabaseService&quot;                           
                         class=&quot;org.springframework.data.neo4j.rest.SpringRestGraphDatabase&quot;&gt;
        &lt;constructor-arg value=&quot;http://localhost:7474/db/data/&quot; index=&quot;0&quot;/&gt;
    &lt;/bean&gt;
    &lt;neo4j:repositories base-package=&quot;org.springframework.samples.travel&quot;/&gt;
&lt;/beans&gt;</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">That's all for this phase &ndash; After running neo4j server, and deploying the application on Tomcat, we had the same Travel application &ndash; but this time working against Neo4J Graph DB.</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm"><u><b>Step 2 &ndash; Integrate MongoDB to Travel Application</b></u></p>

<p style="margin-bottom: 0cm">In this phase we wanted to overload the Travel application with yet another NoSQL &ndash; MongoDB. MongoDB is very popular document datastore, which keeps its documents aggregated in one or more collections inside the DB. MongoDB has a flexible query language (much more flexible than other NoSQL). Nevertheless, for complex operations, like grouping results, you may need to write <a href="http://docs.mongodb.org/manual/applications/map-reduce/">a map-reduce program in MongoDB</a>, and this is exactly what we had to do here.</p>

<p style="margin-bottom: 0cm">Again, we started with Maven dependencies artifacts, and we spent some time to understand, we must take the last dependencies in integrate also with Neo4J dependencies without clashes.</p>

<p style="margin-bottom: 0cm">Then, we created a new domain object called BookingDoc, containing the booking-id and userId:</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<pre title="code" class="brush: java;">
@Document
public class BookingDoc implements Serializable {
    @Id
    private String id;
    private Long userId;
}</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">As you can see, this domain class is annotated with @Document to denote its been persistent as a document in MongoDB, and @Id is the document id.</p>

<p style="margin-bottom: 0cm">Next step, we created a BookingDocRepository interface, which extends SpringData's <a href="http://static.springsource.org/spring-data/data-mongo/docs/1.0.x/apidocs/org/springframework/data/mongodb/repository/MongoRepository.html">MongoRepository</a> base interface. Again no implementation here &ndash; we have the auto-generated one from the SpringData on application startup :)</p>

<p style="margin-bottom: 0cm">Here we have more complicated use case than in Neo4J: In addition to the basic inherited methods from MongoRepository, we wanted to create a custom implementation. This custom implementation method, could NOT be created automatically by naming conventions, as we saw before. The custom method should invoke a map reduce functionality inside the MongoDB. This map-reduce calculates the bookings count for a given user. For that, we had to create yet another interface, BookingDocCustomRepository:</p>

<p>&nbsp;</p>

<pre title="code" class="brush: java;">
public interface BookingDocCustomRepository {
    long countBookingsForUser(long userId);
}</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">This new custom interface is also a base interface for our  BookingDocRepository as follow:</p>

<pre title="code" class="brush: java;">
public interface BookingDocRepository 
                   extends MongoRepository&lt;BookingDoc, Serializable&gt;,BookingDocCustomRepository {
}</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">We created a new implementation repository BookingDocRepositoryImpl, which implements the map-reduce method to calculate the bookings count for the user. Thus, the result on runtime is a &ldquo;mixed-in&rdquo; implementation &ndash; Containing our custom implementation, and the SpringData generated code. Our custom implementation uses SpringData's <a href="http://static.springsource.org/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoTemplate.html">MongoTemplate</a> to invoke the map-reduce code in the DB:</p>

<pre title="code" class="brush: java;">
public class BookingDocRepositoryImpl implements BookingDocCustomRepository{
    
    @Autowired
    private MongoTemplate mongoTemplate;

    @Override
    public long countBookingsForUser(long userId) {
        String mapFunc = String.format(&quot;function() {&quot; +
                            &quot;if(this.userId == %d) &quot; +
                                &quot;emit(this.userId, 1);&quot; +
                            &quot;}&quot;,userId);
        String reduceFunc = &quot;function(k,vals) {&quot; +
                    &quot;var sum=0;&quot;+
                    &quot;for(var i in vals) sum += vals[i];&quot;+
                    &quot;return sum;&quot;+
                &quot;}&quot;;
            
        MapReduceResults&lt;BookingDoc&gt; result = mongoTemplate.mapReduce(&quot;bookingDoc&quot;, mapFunc, reduceFunc, BookingDoc.class);
        BasicDBList list = (BasicDBList) result.getRawResults().get(&quot;results&quot;);
        if(list.isEmpty())
            return 0;
        DBObject object = (DBObject) list.get(0);
        Double d = (Double) object.get(&quot;value&quot;);
        return (long)d.doubleValue();
        
    }
}</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">As you can see, the map method emits tuples of userId and 1, for every booking associated with the input userId. On the other hand, the reduce method accepts the userId and the list of 1, and sum the 1 values. The reduce returns a list of tuples. Nevertheless, since we have only one user as the output of the map method, we have only one tuple in the list.  The tuple's &ldquo;value&rdquo; is the booking count for given user.</p>

<p style="margin-bottom: 0cm">Last, we added Spring configuration for MongoDB. This includes the DB configuration, MongoTemplate and our MongoDB's repositories base package:</p>

<pre title="code" class="brush: java;">
&lt;beans...&gt;
    &lt;context:annotation-config /&gt;
    &lt;util:properties id=&quot;appConfig&quot; location=&quot;classpath:META-INF/spring/application.properties&quot;/&gt;
    &lt;context:property-placeholder properties-ref=&quot;appConfig&quot;/&gt;
    &lt;mongo:mongo host=&quot;${app.config.mongo.host}&quot; port=&quot;${app.config.mongo.port}&quot; /&gt;
    &lt;mongo:repositories base-package=&quot;org.springframework.samples.travel.mongo.repository&quot; mongo-template-ref=&quot;mongoTemplate&quot;/&gt;
    &lt;bean id=&quot;userCredentials&quot; class=&quot;org.springframework.data.authentication.UserCredentials&quot;&gt;
        &lt;constructor-arg name=&quot;username&quot; value=&quot;${app.config.mongo.user}&quot; /&gt;
        &lt;constructor-arg name=&quot;password&quot; value=&quot;${app.config.mongo.password}&quot; /&gt;
    &lt;/bean&gt;
    &lt;bean id=&quot;mongoTemplate&quot; class=&quot;org.springframework.data.mongodb.core.MongoTemplate&quot;&gt;
        &lt;constructor-arg ref=&quot;mongo&quot; /&gt;
        &lt;constructor-arg name=&quot;databaseName&quot; value=&quot;${app.config.mongo.databasename}&quot; /&gt;
        &lt;constructor-arg ref=&quot;userCredentials&quot; /&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm"><u><strong>Phase 3 &ndash; Put it all together</strong></u></p>

<p style="margin-bottom: 0cm">We updated the BookingService implementation code to save the BookingDoc to MongoDB right after saving the Booking to Neo4J, using our new repositories:</p>

<pre title="code" class="brush: java;">
public Booking createBooking(Long hotelId, String username) {
        Hotel hotel = hotelRepository.findOne(hotelId);
        User user = userRepository.findByUsername(username);
        Booking booking = new Booking(hotel, user);
        neo4jOps.save(booking);
        bookingDocRepository.save(new BookingDoc(user.getId(), booking.getCreditCard()));
        return booking;
    }</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">We also added simple method that calculates the booking count in the service that delegates it to our repository:</p>

<pre title="code" class="brush: java;">
@Override
    public long countBookingsForUser(long userId){
        return bookingDocRepository.countBookingsForUser(userId);
    }</pre>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">That's it &ndash; you have a running Spring travel application using two NoSQL storages with SpringData.</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm"><u><b>Conclusion</b></u></p>

<p style="margin-bottom: 0cm">We had much pleasure playing with NoSQL and SpringData in this Tikal Fuse day. We faced the nice SpringData features, neglecting the <a href="http://relation.to/1350.lace">old &ldquo;GenericDao&rdquo; pattern</a>. We were also happy to drop DAO implementations classes (typically dozens empty useless in a regular applications), and use SpringData's &ldquo;query by convention&rdquo; and annotations.</p>

<p style="margin-bottom: 0cm">We have the confidence now,we can really integrate more than one NoSQL in the same project with SpringData, by making sure the right Maven dependencies, making it as a <a href="http://martinfowler.com/bliki/PolyglotPersistence.html">Polyglot Persistence</a> application. You can download the Travel NoSQL application from Tikal GitHub.</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p style="margin-bottom: 0cm">&nbsp;</p>

<p>&nbsp;</p>

                    <div class="fb-comments" data-href="http://tikalk.com/java/travel-nosql-application-polyglot-nosql-springdata-neo4j-and-mongodb" data-width="600px" data-numposts="5" data-colorscheme="light"></div>
                    <footer></footer>
                  </article>
                </div>
              </div>
            </div>
          </div>
        </div>
        <footer id="footer" role="contentinfo">
  <div class="region region-footer">
    <section id="block-block-2" class="block block-block block-about-tikal block-even">
      <h2 class="block-title">About Tikal</h2>

      <div class="content">
        <div>
          <div>
            For over 12 years, we have helped breakthrough companies achieve excellence and meet their goals.&nbsp;</div>
          <div>
            By doing so we've earned recognition for delivering extremely competitive and high-performance software services to clients worldwide.</div>
        </div>
        <div class="contact-title">
          Contact Information</div>
        <div class="contact-number">
          (972) 3 6488618</div>
        <div class="contact-mail">
          <a href="">info@tikalk.com</a></div>
      </div><!-- /.content -->
    </section><!-- /.block -->
    <section id="block-webform-client-block-22" class="block block-webform join-the-team block-odd">
      <h2 class="block-title">Join the Team</h2>
      <div class="content">
        <div>
          <div class="form-item webform-component webform-component-markup" id="webform-component-sub-header">
              <p>Let us contact you with more information</p>
          </div>
          <script type="text/javascript" src="http://form.jotform.me/jsform/41884289305463"></script>
        </div>
      </div><!-- /.content -->
    </section><!-- /.block -->
    <section id="block-general-tikal-map-home-page" class="block block-general-tikal block-even">
      <h2 class="block-title">Find us at:</h2>

      <div class="content">

        <div id="map_canvas_footer" style="width: 240px; height: 200px;"></div>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
        <script type="text/javascript">
            var latlng = new google.maps.LatLng(32.1065469,34.83523969999999);
            var settings = {
            zoom: 15,
                  center: latlng,
                  mapTypeControl: false,
                  mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
                  navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
                  mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map_canvas_footer"), settings);      
            var companyImage = new google.maps.MarkerImage("/assets/icons/logo-map-1a2609d2dd636172949b30cd33a1d8a0.png",
                new google.maps.Size(100,50),
                new google.maps.Point(0,0),
                new google.maps.Point(50,50)
            );
            var companyShadow = new google.maps.MarkerImage("images/logo_shadow.png",
                new google.maps.Size(130,50),
                new google.maps.Point(0,0),
                new google.maps.Point(65, 50)
            );
            var companyPos = new google.maps.LatLng(32.1065469,34.83523969999999);
            var companyMarker = new google.maps.Marker({
              position: companyPos,
              map: map,
              icon: companyImage,
              shadow: companyShadow,
              title:"",
              zIndex: 3}
            );
        </script>  
      </div><!-- /.content -->
    </section><!-- /.block -->
    <div id="block-block-3" class="block block-block find-us-at block-odd">
      <div class="content">
        <div class="address">
          Habarzel 4 st, 1st Floor&nbsp;<br>
          Tel Aviv 69710<br>
          Israel
        </div>  
      </div><!-- /.content -->
    </div><!-- /.block -->
  </div>
</footer>

        <footer id="footer-second" role="contentinfo">
  <div class="region region-footer-second">
    <section id="block-views-popular-articles-block" class="block block-views block-even">
      <h2 class="block-title">Popular Articles</h2>

      <div class="content">
        <div class="view view-popular-articles view-id-popular_articles view-display-id-block view-dom-id-796319b1b70c397287cdccd16eebbb82">

          <div class="view-content">
            <div class="view-content-limit">
              <div class="view-content-limit-content">
                <div class="views-row views-row-1 views-row-odd views-row-first">

                  <div class="views-field views-field-title">        <span class="field-content"><a href="/java/location-auto-complete-and-lookup">Location Auto complete and lookup</a></span>  </div>  </div>
                <div class="views-row views-row-2 views-row-even">

                  <div class="views-field views-field-title">        <span class="field-content"><a href="/js/present-and-future-typescript">Present and future of TypeScript</a></span>  </div>  </div>
                <div class="views-row views-row-3 views-row-odd views-row-last">

                  <div class="views-field views-field-title">        <span class="field-content"><a href="/ror/building-gogobot-social-graph">building the gogobot social graph</a></span>  </div>  </div>
              </div>
            </div>
          </div>

      </div>  </div><!-- /.content -->
    </section><!-- /.block -->
    <section id="block-menu-menu-fields" class="block block-menu block-odd">
      <h2 class="block-title">Domains</h2>

      <div class="content">
        <ul class="menu clearfix"><li class="first leaf application lifecycle management"><a href="/alm" title="">DevOps</a></li>
          <li class="leaf java"><a href="/java" title="">Java</a></li>
          <li class="leaf javascript"><a href="/js" title="">JavaScript</a></li>
          <li class="leaf .net"><a href="/net" title="">Android</a></li>
          <li class="last leaf ruby on rails"><a href="/ror" title="">Ruby</a></li>
      </ul>  </div><!-- /.content -->
    </section><!-- /.block -->
    <section id="block-menu-menu-site-map" class="block block-menu block-even">
      <h2 class="block-title">Site Map</h2>

      <div class="content">
        <ul class="menu clearfix"><li class="first leaf about us"><a href="/about" title="">About Us</a></li>
          <li class="leaf active-trail solutions"><a href="/solutions" title="" class="active-trail active">Solutions</a></li>
          <li class="leaf careers"><a href="/careers" title="">Careers</a></li>
          <li class="leaf events"><a href="/events" title="">Events</a></li>
          <li class="last leaf contact"><a href="/contact" title="">Contact</a></li>
      </ul>  </div><!-- /.content -->
    </section><!-- /.block -->
    <div id="block-block-1" class="block block-block all-rights-reserved block-odd">

      <div class="content">
        <p>© 2013 All Rights Reserved. Tikal</p>
      </div><!-- /.content -->
    </div><!-- /.block -->
    <div id="block-menu-menu-external-links" class="block block-menu block-even">

      <div class="content">
        <ul class="menu clearfix"><li class="first leaf facebook"><a href="http://www.facebook.com/TikalKnowledge" title="" target="_blank">Facebook</a></li>
          <li class="leaf twitter"><a href="https://twitter.com/TikalK" title="" target="_blank">Twitter</a></li>
          <li class="leaf in"><a href="http://www.linkedin.com/company/tikal-knowledge" title="" target="_blank">in</a></li>
          <li class="last leaf rss"><a href="/rss-latest-articles" title="Latest Articles">RSS</a></li>
      </ul>  </div><!-- /.content -->
    </div><!-- /.block -->
  </div>
</footer>

    </body>
</html>
